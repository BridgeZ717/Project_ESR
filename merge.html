<!DOCTYPE html>
<html>

<head>
    <title>Merge</title>
    <!-- Chart JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <!-- Jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- CSS -->
    <link rel="stylesheet" href="styles.css">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
</head>

<body>
    <div class="topnav">
        <a href="Natural_X.html">X Chart</a>
        <a href="Natural_Y.html">Y Chart</a>
        <a href="Natural_Z.html">Z Chart</a>
        <a class="active" href="merge.html">Merge Chart</a>
    </div>
    <div>
        <button onclick="creatChart()">Show Chart</button>
    </div>
    <canvas id="myChart"></canvas>
    <div id="minmax"></div>
    <script>

        const xlabels = [];
        var xAve = [];
        var yAve = [];
        var zAve = [];
        const finalAve = [];

        async function creatChart() {
            xlabelsFlag = 0;
            //degree = 0;
           await getData();
            for (var i = 0; i < xAve.length; i++) {
                xlabels.push(i);
            }

            finAverage(finalAve, xAve, yAve, zAve)


            const ctx = document.getElementById('myChart').getContext('2d');
            const chart = new Chart(ctx, {
                // The type of chart we want to create
                type: 'line',
                // The data for our dataset
                data: {
                    labels: xlabels,
                    datasets: [{
                        label: 'Merge',
                        fill: false,
                        //backgroundColor: 'rgb(255, 99, 132)',
                        borderWidth: 2,
                        borderColor: 'rgb(255, 0, 0)',
                        data: finalAve
                    }, {
                            label: 'X average',
                            fill: false,
                            //backgroundColor: 'rgb(255, 99, 132)',
                            borderColor: 'rgb(0, 255, 0)',
                            borderWidth: 2,
                            data: xAve
                        }, {
                            label: 'Y average',
                            fill: false,
                            //backgroundColor: 'rgb(255, 99, 132)',
                            borderColor: 'rgb(255, 0, 255)',
                            borderWidth: 2,
                            data: yAve
                        }, {
                            label: 'Z average',
                            fill: false,
                            //backgroundColor: 'rgb(255, 99, 132)',
                            borderColor: 'rgb(0, 255, 255)',
                            borderWidth: 2,
                            data: zAve
                        }]
                },

                // Configuration options go here
                options: {}
            });
        }
        async function getData(){
            var xAveArr = sessionStorage.getItem('xAveArr');
           var yAveArr = sessionStorage.getItem('yAveArr');
           var zAveArr = sessionStorage.getItem('zAveArr');
            
           
          const Xrows = xAveArr.split(',').slice(); //each line becomes to a variable, slice(51) -> ignore index 0(title) start from index 51
            Xrows.forEach(elt => {
                xAve.push(elt);
            });

            const Yrows = yAveArr.split(',').slice(); //each line becomes to a variable, slice(51) -> ignore index 0(title) start from index 51
            Yrows.forEach(elt => {
                yAve.push(elt);
            });

            const Zrows = zAveArr.split(',').slice(); //each line becomes to a variable, slice(51) -> ignore index 0(title) start from index 51
            Zrows.forEach(elt => {
                zAve.push(elt);
            });
        }

        function finAverage(arr, x, y, z) {
            for (var i = 0; i < x.length; i++) {
                const ave = ((+x[i]) + (+y[i]) + (+z[i])) / 3
                arr.push(ave);
            }
            const min = Math.min.apply(null, arr),
                max = Math.max.apply(null, arr);
            document.getElementById("minmax").innerHTML += " Min: " + min + " Max: " + max + "<br>";
        }
    </script>



</body>

</html>